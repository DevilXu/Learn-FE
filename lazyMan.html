<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <script>
    function LazyMan({name= '姓名'}) {
      if (!(this instanceof LazyMan)) {
        return new LazyMan({name});
      }
      this.taskList = [];
      this.name = name;
      this.index = 0;
      this._init();
      setTimeout(() => {
        this.dequence();
      }, 10)
    }
    LazyMan.prototype._init = function(name) {
      const func = (next) => {
        console.log(`hello, ${this.name}!`);
        next();
      }
      this.taskList.push(func);
      return this;
    }
    LazyMan.prototype.sleep = function(time) {
      const timer = async (next) => {
        await new Promise((resolve) => {
          setTimeout(() => {
            console.log(`${this.name} sleep ${time}!`);
            resolve();
            next();
          }, time)
        })
      }
      this.taskList.push(timer);
      return this;
    }
    LazyMan.prototype.eat = function(food) {
      const func = (next) => {
        console.log(`${this.name} eat ${food}!`);
        next();
      }
      this.taskList.push(func);
      return this;
    }
    LazyMan.prototype.dequence = function() {
      const dispatch = (index) => {
        const func = this.taskList[index];
        if (!func) return Promise.resolve();
        return func(() => {
          return dispatch(++ index)
        }); 
      }
      dispatch(0);
    }
    LazyMan({name: 'miracle'}).sleep(2000).eat('hamburger'); // 输出 'hello,miracle!',休息2秒,输出'miracle eat hanburger'
  </script>
</body>
</html>